syntax = "proto3";

package zorro;
option go_package = "github.com/Acedyn/zorro-core/internal/scheduling";

// Clients are responsible for executing commands
message Client {
  // The name of the executable
  string name = 1;
  // Used to differentiate two same clients with a different version
  string version = 2;
  // User friently version of the name without all its contraints
  optional string label = 3;
  // Paths where we should look for the executable
  repeated string paths = 4;
  // Defines if this client can be used as a substitute for other clients
  repeated string subsets = 5;
  // Template to launch the program without the client running
  string launch_program_template = 6;
  // Template to launch the program with the client running
  string launch_client_template = 7;
}

// Filters used to select a client from a client pool
message ClientQuery {
  optional string name = 1;
  optional int32 pid = 2;
  map<string, string> metadata = 3;
}

enum ClientStatus {
  CREATED = 0; // When the class is instanciated but the program is not running
  STARTING = 1; // The program is starting
  IDLE = 2; // The program is running but not executing any commands
  PROCESSING = 3; // The program is running and executing commands
  SHUTTING_DOWN = 4; // The program received a shutting down command
  SHUT_DOWN = 5; // The program is now off
  NOT_RESPONDING = 6; // No ping received from the client for a certain amound of time
}

// Handle of an instance to a client
message RunningClient {
  // The client definition at the origin of this running client
  Client client = 1;
  // Help knowing at which state is the client
  ClientStatus status = 2;
  // PID of the underlying running process
  int32 pid = 3;
  // Extra data used mainly for filters
  map<string, string> metadata = 4;
}
